# Vision GNN训练流程详解

## 1. 数据准备流程
1.1 数据集信息
- 使用ImageNette数据集(ImageNet的一个子集)
- 包含10个类别的图像数据
- 数据已预先划分为训练集和验证集

1.2 数据加载与预处理 
- DataLoader参数:batch_size=32, num_workers=4, pin_memory=True
- 图像统一resize为224x224大小
- 像素值归一化:[0.485, 0.456, 0.406]/[0.229, 0.224, 0.225]

1.3 数据增强方案
训练集增强:
- RandAugment随机增强
- RandomHorizontalFlip(p=0.5)
- RandomErasing随机遮挡
验证集增强:
- 仅做基础的Resize和Normalize

## 2. 模型架构设计
2.1 总体结构
- 输入层:将图像分割为16x16的patches
- 主干网络:Vision GNN多层堆叠
- 输出层:全连接分类头

2.2 关键组件说明
- Patch Embedding: 降维+位置编码
- ViGBlock: 图结构特征提取模块
- 分类头: 320维特征映射到类别数

2.3 核心参数配置 
- patch_size = 16
- embedding_dim = 320 
- num_blocks = 16
- num_edges = 9
- num_heads = 1

## 3. 训练策略
3.1 训练流程图
+-----------------------------------------------------------------------------------------------------------+
|                                              训练初始化                                                     |
|  +-----------------+    +------------------+    +-------------------+    +-----------------+                |
|  | 加载配置文件     | -> | 初始化数据加载器   | -> |   构建Vision GNN    | -> | 设置优化器参数   |              |
|  +-----------------+    +------------------+    +-------------------+    +-----------------+                |
|                                                                                                             |
|                    +--------------------------------------------------------+                               |
|                    |                         训练循环(Epochs)                  |                             |
|                    |     +------------------------------------------------+  |                              |
|                    |     |                  训练阶段                       |  |                              |
|                    |     |   +------------+    +-----------+              |  |                              |
|                    |     |   | 加载批次数据| -> | 前向传播   |              |  |                              |
|                    |     |   +------------+    +-----------+              |  |                              |
|                    |     |                         |                      |  |                              |
|                    |     |                    +-----------+               |  |                              |
|                    |     |                    | 计算损失   |               |  |                              |
|                    |     |                    +-----------+               |  |                              |
|                    |     |                         |                      |  |                              |
|                    |     |                    +-----------+               |  |                              |
|                    |     |                    | 反向传播   |               |  |                              |
|                    |     |                    +-----------+               |  |                              |
|                    |     |                         |                      |  |                              |
|                    |     |                    +-----------+               |  |                              |
|                    |     |                    | 更新参数   |               |  |                              |
|                    |     |                    +-----------+               |  |                              |
|                    |     +------------------------------------------------+  |                              |
|                    |                              |                          |                              |
|                    |     +------------------------------------------------+  |                              |
|                    |     |                  验证阶段                       |  |                              |
|                    |     |   +------------+    +-----------+              |  |                              |
|                    |     |   | 验证集预测  | -> | 计算准确率 |              |  |                              |
|                    |     |   +------------+    +-----------+              |  |                              |
|                    |     |                         |                      |  |                              |
|                    |     |                  +--------------+              |  |                              |
|                    |     |                  | 更新最佳模型  |              |  |                              |
|                    |     |                  +--------------+              |  |                              |
|                    |     +------------------------------------------------+  |                              |
|                    +--------------------------------------------------------+                               |
|                                                |                                                            |
|                                         +--------------+                                                    |
|                                         |  保存模型     |                                                    |
|                                         +--------------+                                                    |
+-----------------------------------------------------------------------------------------------------------+

3.2 优化器设置
- 优化器:Adam 
- 学习率:1e-3
- 损失函数:CrossEntropyLoss

3.3 训练流程
每轮epoch包含:
1) 训练阶段
   - 打乱数据
   - 批次迭代
   - 前向传播
   - 计算损失
   - 反向传播
   - 参数更新
   
2) 验证阶段  
   - 关闭梯度计算
   - 批次预测
   - 计算准确率
   - 保存最佳模型

## 4. 保存与记录
4.1 模型保存
- 触发条件:验证集准确率提升
- 保存内容:模型参数字典
- 保存路径:YYYY-MM-DD_HHMM/best_model.pth

4.2 日志记录
记录以下信息:
- 训练配置
- 每轮loss
- 验证准确率
- 最佳性能
- 训练用时

## 5. 注意事项
1. GPU显存占用
   - batch_size需要根据显存大小调整
   - 可使用梯度累积减少显存占用

2. 训练稳定性
   - 观察loss曲线变化
   - 监控验证集性能防止过拟合
   - 确保学习率设置合理

3. 环境配置
   - 推荐使用GPU训练
   - 确保CUDA版本兼容
   - 检查数据集路径正确